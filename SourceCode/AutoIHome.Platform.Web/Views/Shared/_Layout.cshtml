<!DOCTYPE html>
<html>
    <head>
        <meta name="viewport" content="width=device-width" />
        <title>车艾家-@base.ViewData["Title"]</title>
        <!--样式-->
        <link rel="stylesheet" href="~/lib/font-awesome/css/font-awesome.min.css" />
        <link rel="stylesheet" href="~/lib/layui/css/layui.css" />
        <link rel="stylesheet" href="~/lib/bootstrap/css/bootstrap.min.css" />
        <link rel="stylesheet" href="~/lib/pnotify/PNotifyBrightTheme.css" />
        <link rel="stylesheet" href="~/css/page-layout.css" />
        <link rel="stylesheet" href="~/css/ext-bootstrap.css" />
        <link rel="stylesheet" href="~/css/ext-utils.css" />
        @RenderSection("styles", false)
        <!--脚本-->
        <script type="text/javascript" src="~/lib/jquery/jquery.min.js"></script>
        <script type="text/javascript" src="~/lib/layui/layui.js"></script>
        <script type="text/javascript" src="~/lib/bootstrap/js/bootstrap.bundle.min.js"></script>
        <script type="text/javascript" src="~/lib/bootbox/bootbox.all.min.js"></script>
        <script type="text/javascript" src="~/lib/pnotify/umd/PNotify.js"></script>
        <script type="text/javascript" src="~/js/ext-jquery.js"></script>
        <script type="text/javascript" src="~/js/ext-utils.js"></script>
        <script type="text/javascript" src="~/js/ext-loaders.js"></script>
        <script type="text/javascript" src="~/js/ext-containers.js"></script>
        <script type="text/javascript" src="~/js/ext-submitters.js"></script>
        <!--bootstrap初始化函数-->
        <script type="text/javascript">
            //初始化加载所有的提示框
            function init_bootstrap_tooltips() {
                document.querySelectorAll('[data-bs-toggle="tooltip"]').forEach(function (htmlToolTip) {
                    new bootstrap.Tooltip(htmlToolTip);
                });
            }
            //初始化加载所有的模态框
            function init_bootstrap_modals() {
                //遍历所有的.modal容器
                document.querySelectorAll('body > .modal').forEach(function (divModal) {
                    new bootstrap.Modal(divModal);
                });
            }
        </script>
        <!--显示授权的菜单列表-->
        <script type="text/javascript">
            //获取当前登录角色下所有授权的菜单的url
            function get_url_for_login_role_menus() { return '@Url.Action("GetLoginRoleMenus", "Role", new { area = "SysManagement" })'; }

            //显示当前登录角色下所有授权的菜单
            function show_login_role_menus() {
                //执行jquery ajax的post方法
                $.post(get_url_for_login_role_menus(), function (data, textStatus, xhr) {
                    //记录log
                    console.log(textStatus);
                    //遍历所有菜单名称
                    data.forEach(function (sMenuName) {
                        //获取当前li元素
                        let li = document.querySelector('#nav-child-menus > ul > li[data-name="' + sMenuName + '"]');
                        //若li不为空
                        if (li != undefined) {
                            //若包含(d-none)类样式则移除
                            if (li.classList.contains('d-none'))
                                li.classList.remove('d-none');
                        }
                    });
                });
            }
        </script>
        <!--加载选中菜单-->
        <script type="text/javascript">
            //获取模块名称
            function get_module_name() { return '@base.ViewData["Module"]'; }
            //获取菜单名称
            function get_menu_name() { return '@base.ViewData["Menu"]'; }

            //选中菜单
            function select_menu() {
                //若模块名称为空则退出
                let sModuleName = get_module_name();
                if (sModuleName == '')
                    return;
                //若菜单名称为空则退出
                let sMenuName = get_menu_name();
                if (sMenuName == '')
                    return;
                //选中一级菜单
                document.querySelector('#ul-sidebar > .nav-item[data-name="' + sModuleName + '"] .nav-link').classList.add('active');
                //获取二级菜单集合所在的模块
                let ulModule = document.querySelector('#nav-child-menus > .navbar-nav[data-name="' + sModuleName + '"]');
                //展开子菜单集合
                ulModule.classList.remove('d-none');
                //选中二级菜单
                ulModule.querySelector('.nav-item[data-name="' + sMenuName + '"] > .nav-link').classList.add('active');
            }
        </script>
        <!--页面函数-->
        <script type="text/javascript">
            //展示子菜单集合
            function show_child_menus(a) {
                //取消其他选择项
                $('#ul-sidebar .active').removeClass('active');
                //设置当前a标签为选中状态
                $(a).addClass('active');
                //展示子菜单
                var sModule = $(a).parent().attr('data-name');
                $('#nav-child-menus .navbar-nav[data-name!="' + sModule + '"]').addClass('d-none');
                $('#nav-child-menus .navbar-nav[data-name="' + sModule + '"]').removeClass('d-none');
            }
        </script>
        <!--分页-->
        <script type="text/javascript">
            //获取加载分页页码的url
            function get_url_for_show_paging() { return '@Url.Action("ShowPaging", "Base", new { area = ""})'; }

            //加载分页页码
            function load_pages(divContainer, startIndex) {
                //创建html加载器
                var oHtmlLoader = new HtmlLoader(divContainer);
                //指定查询url
                oHtmlLoader.url = get_url_for_show_paging();
                //指定查询参数
                oHtmlLoader.data = {
                    StartIndex: startIndex,
                    PageIndex: divContainer.querySelector('input[name="PageIndex"]').value,
                    PageCount: divContainer.querySelector('label[for="PageCount"]').textContent,
                    PageSize: divContainer.querySelector('input[name="PageSize"]').value,
                    Count: divContainer.querySelector('label[for="Count"]').textContent,
                    FunctionName: divContainer.querySelector('input[name="FunctionName"]').value
                };
                //加载数据
                oHtmlLoader.load();
            }
        </script>
        <!--修改密码-->
        <script type="text/javascript">
            //获取显示编辑当前登录用户的密码的url
            function get_url_for_edit_password() { return '@Url.Action("ShowEditPassword", "User", new { area = "SysManagement" })'; }
            //获取保存密码的url
            function get_url_for_save_password() { return '@Url.Action("SavePassword", "User", new { area = "SysManagement" })'; }

            //显示编辑当前登录用户的密码
            function show_edit_password() {
                //创建容器对象
                let oContainer = new ModalDialogContainer('div-modal-dialog-0');
                //指定url
                oContainer.url = get_url_for_edit_password();
                //显示当前容器
                oContainer.show();
            }
            //保存修改的密码
            function save_password(form) {
                //创建表单提交对象
                let oSubmitter = new DataFormSubmitter(form);
                //指定提交地址
                oSubmitter.url = get_url_for_save_password();
                //指定执行成功后的回掉函数
                oSubmitter.call_back = function () {
                    //关闭当前模态框
                    close_dialog($(form).parents('.modal').get(0));
                };
                //执行提交
                oSubmitter.submit();
            }
        </script>
        @RenderSection("scripts", false)
    </head>
    <body>
        <!--页头-->
        <header class="row">
            <nav class="col-md-4 navbar left">
                <i class="fa fa-2x fa-car text-info">平台管理</i>
            </nav>
            <nav class="col-md-8 navbar justify-content-end">
                <div class="col-md-2 text-end">
                    <i class="text-primary">@base.ViewData["UserName"]</i>
                    &nbsp;
                    <primary-link click="show_edit_password();">
                        <i class="fa fa-edit" data-bs-toggle="tooltip" data-bs-placement="bottom" title="修改密码"></i>
                    </primary-link>
                    &nbsp;
                    <a class="text-primary" asp-area="" asp-controller="Home" asp-action="Logout">
                        <i class="fa fa-power-off" data-bs-toggle="tooltip" data-bs-placement="bottom" title="登出"></i>
                    </a>
                </div>
            </nav>
        </header>
        <!--主体内容-->
        <div class="row" id="div-content">
            <!--左边菜单-->
            <div class="col-md-2 h-100">
                <ul class="nav flex-column" id="ul-sidebar">
                    <li class="nav-item">
                        <a class="nav-link" asp-area="" asp-controller="Home" asp-action="Index">
                            <i class="fa fa-home"></i>
                            <span>主&nbsp;&nbsp;&nbsp;&nbsp;页</span>
                        </a>
                    </li>
                    <li class="nav-item" data-name="vehicle-owner">
                        <a class="nav-link" href="javascript:void(0);" onclick="show_child_menus(this);">
                            <i class="fa fa-car"></i>
                            <span>车主服务</span>
                        </a>
                    </li>
                    <li class="nav-item" data-name="member-management">
                        <a class="nav-link" href="javascript:void(0);" onclick="show_child_menus(this);">
                            <i class="fa fa-address-book"></i>
                            <span>会员管理</span>
                        </a>
                    </li>
                    <li class="nav-item" data-name="inventory-management">
                        <a class="nav-link" href="javascript:void(0);" onclick="show_child_menus(this);">
                            <i class="fa fa-database"></i>
                            <span>库存管理</span>
                        </a>
                    </li>
                    <li class="nav-item" data-name="emp-management">
                        <a class="nav-link" href="javascript:void(0);" onclick="show_child_menus(this);">
                            <i class="fa fa-user"></i>
                            <span>员工管理</span>
                        </a>
                    </li>
                    <li class="nav-item" data-name="reg-management">
                        <a class="nav-link" href="javascript:void(0);" onclick="show_child_menus(this);">
                            <i class="fa fa-area-chart"></i>
                            <span>区域管理</span>
                        </a>
                    </li>
                    <li class="nav-item" data-name="basic-data">
                        <a class="nav-link" href="javascript:void(0);" onclick="show_child_menus(this);">
                            <i class="fa fa-database"></i>
                            <span>基础数据</span>
                        </a>
                    </li>
                    <li class="nav-item" data-name="setting">
                        <a class="nav-link" href="javascript:void(0);" onclick="show_child_menus(this);">
                            <i class="fa fa-cog"></i>
                            <span>系统设置</span>
                        </a>
                    </li>
                    <li class="nav-item" data-name="trash">
                        <a class="nav-link" href="javascript:void(0);" onclick="show_child_menus(this);">
                            <i class="fa fa-recycle"></i>
                            <span>回&nbsp;收&nbsp;站</span>
                        </a>
                    </li>
                </ul>
            </div>
            <!--内容-->
            <div class="col-md-10 p-0 h-100">
                <!--二级菜单-->
                <nav class="navbar navbar-expand-lg" id="nav-child-menus">
                    <!--车主下的二级菜单-->
                    <ul class="navbar-nav d-none" data-name="vehicle-owner">
                        <li class="nav-item">
                            <a class="nav-link parallelogram" href="javascript:void(0);">
                                <span class="text">预约记录</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link parallelogram" href="javascript:void(0);">
                                <span class="text">营业日报</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link parallelogram" href="javascript:void(0);">
                                <span class="text">产值汇总</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link parallelogram" href="javascript:void(0);">
                                <span class="text">项目分析</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link parallelogram" href="javascript:void(0);">
                                <span class="text">车主评价</span>
                            </a>
                        </li>
                    </ul>
                    <!--会员下的二级菜单-->
                    <ul class="navbar-nav d-none" data-name="member-management">
                        <li class="nav-item">
                            <a class="nav-link parallelogram" href="javascript:void(0);">
                                <span class="text">会员列表</span>
                            </a>
                        </li>
                        <li class="nav-item" data-name="view-customers">
                            <a class="nav-link parallelogram" href="javascript:void(0);">
                                <span class="text">全部客户</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link parallelogram" href="javascript:void(0);">
                                <span class="text">群发消息</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link parallelogram" href="javascript:void(0);">
                                <span class="text">生日提醒</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link parallelogram" href="javascript:void(0);">
                                <span class="text">售后提醒</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link parallelogram" href="javascript:void(0);">
                                <span class="text">电话回访</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link parallelogram" href="javascript:void(0);">
                                <span class="text">客户导入</span>
                            </a>
                        </li>
                    </ul>
                    <!--库存下的二级菜单-->
                    <ul class="navbar-nav d-none" data-name="inventory-management">
                        <li class="nav-item">
                            <a class="nav-link parallelogram" href="javascript:void(0);">
                                <span class="text">配件待出</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link parallelogram" href="javascript:void(0);">
                                <span class="text">入库管理</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link parallelogram" href="javascript:void(0);">
                                <span class="text">出库管理</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link parallelogram" href="javascript:void(0);">
                                <span class="text">出库查询</span>
                            </a>
                        </li>
                        <li class="nav-item" data-name="edit-parts">
                            <a class="nav-link parallelogram" href="javascript:void(0);">
                                <span class="text">配件库</span>
                            </a>
                        </li>
                        <li class="nav-item" data-name="edit-warehouses">
                            <a class="nav-link parallelogram" href="javascript:void(0);">
                                <span class="text">库房设置</span>
                            </a>
                        </li>
                        <li class="nav-item" data-name="check-parts">
                            <a class="nav-link parallelogram" href="javascript:void(0);">
                                <span class="text">库存盘点</span>
                            </a>
                        </li>
                        <li class="nav-item" data-name="edit-part-suppliers">
                            <a class="nav-link parallelogram" href="javascript:void(0);">
                                <span class="text">配件商</span>
                            </a>
                        </li>
                    </ul>
                    <!--员工管理下的二级菜单-->
                    <ul class="navbar-nav d-none" data-name="emp-management">
                        <li class="nav-item d-none" data-name="edit-departments">
                            <a class="nav-link parallelogram" asp-area="EmpManagement" asp-controller="Department" asp-action="Index">
                                <span class="text">部门管理</span>
                            </a>
                        </li>
                        <li class="nav-item d-none" data-name="edit-jobs">
                            <a class="nav-link parallelogram" asp-area="EmpManagement" asp-controller="Job" asp-action="Index">
                                <span class="text">职位管理</span>
                            </a>
                        </li>
                        <li class="nav-item d-none" data-name="edit-employees">
                            <a class="nav-link parallelogram" asp-area="EmpManagement" asp-controller="Employee" asp-action="Index">
                                <span class="text">员工管理</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link parallelogram" href="javascript:void(0);">
                                <span class="text">考勤管理</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link parallelogram" href="javascript:void(0);">
                                <span class="text">请假条</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link parallelogram" href="javascript:void(0);">
                                <span class="text">奖惩记录</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link parallelogram" href="javascript:void(0);">
                                <span class="text">员工绩效</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link parallelogram" href="javascript:void(0);">
                                <span class="text">员工提成</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link parallelogram" href="javascript:void(0);">
                                <span class="text">工资报表</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link parallelogram" href="javascript:void(0);">
                                <span class="text">员工毛利贡献</span>
                            </a>
                        </li>
                    </ul>
                    <!--区域管理下的二级菜单-->
                    <ul class="navbar-nav d-none" data-name="reg-management">
                        <li class="nav-item d-none" data-name="edit-province-levels">
                            <a class="nav-link parallelogram" asp-area="RegManagement" asp-controller="ProvinceLevel" asp-action="Index">
                                <span class="text">省级行政区</span>
                            </a>
                        </li>
                        <li class="nav-item d-none" data-name="edit-prefecture-levels">
                            <a class="nav-link parallelogram" asp-area="RegManagement" asp-controller="PrefectureLevel" asp-action="Index">
                                <span class="text">地级行政区</span>
                            </a>
                        </li>
                        <li class="nav-item d-none" data-name="edit-county-levels">
                            <a class="nav-link parallelogram" asp-area="RegManagement" asp-controller="CountyLevel" asp-action="Index">
                                <span class="text">县级行政区</span>
                            </a>
                        </li>
                    </ul>
                    <!--基础数据下的菜单-->
                    <ul class="navbar-nav d-none" data-name="basic-data">
                        <li class="nav-item d-none" data-name="edit-object-type-categories">
                            <a class="nav-link parallelogram" asp-area="BaseManagement" asp-controller="ObjectTypeCategory" asp-action="Index">
                                <span class="text">基础类型分类</span>
                            </a>
                        </li>
                        <li class="nav-item d-none" data-name="edit-object-types">
                            <a class="nav-link parallelogram" asp-area="BaseManagement" asp-controller="ObjectTypeCategory" asp-action="ObjectTypes">
                                <span class="text">基础类型管理</span>
                            </a>
                        </li>
                        <li class="nav-item" data-name="edit-provinces">
                            <a class="nav-link parallelogram" asp-area="RegManagement" asp-controller="Province" asp-action="Index">
                                <span class="text">省份管理</span>
                            </a>
                        </li>
                        <li class="nav-item" data-name="edit-cities">
                            <a class="nav-link parallelogram" asp-area="RegManagement" asp-controller="Province" asp-action="City">
                                <span class="text">城市管理</span>
                            </a>
                        </li>
                        <li class="nav-item" data-name="search-cities">
                            <a class="nav-link parallelogram" asp-area="RegManagement" asp-controller="City" asp-action="Index">
                                <span class="text">城市查询</span>
                            </a>
                        </li>
                        <li class="nav-item" data-name="edit-counties">
                            <a class="nav-link parallelogram" asp-area="RegManagement" asp-controller="City" asp-action="County">
                                <span class="text">区县管理</span>
                            </a>
                        </li>
                    </ul>
                    <!--设置下的二级菜单-->
                    <ul class="navbar-nav d-none" data-name="setting">
                        <li class="nav-item d-none" data-name="edit-roles">
                            <a class="nav-link parallelogram" asp-area="SysManagement" asp-controller="Role" asp-action="Index">
                                <span class="text">角色管理</span>
                            </a>
                        </li>
                        <li class="nav-item d-none" data-name="edit-role-rights">
                            <a class="nav-link parallelogram" asp-area="SysManagement" asp-controller="Role" asp-action="Right">
                                <span class="text">角色授权</span>
                            </a>
                        </li>
                        <li class="nav-item d-none" data-name="edit-users">
                            <a class="nav-link parallelogram" asp-area="SysManagement" asp-controller="User" asp-action="Index">
                                <span class="text">用户管理</span>
                            </a>
                        </li>
                        <li class="nav-item d-none" data-name="edit-parameter-categories">
                            <a class="nav-link parallelogram" asp-area="CfgManagement" asp-controller="ParameterCategory" asp-action="Index">
                                <span class="text">参数分类</span>
                            </a>
                        </li>
                        <li class="nav-item d-none" data-name="edit-parameters">
                            <a class="nav-link parallelogram" asp-area="CfgManagement" asp-controller="ParameterCategory" asp-action="Parameters">
                                <span class="text">配置参数</span>
                            </a>
                        </li>
                        <li class="nav-item d-none" data-name="search-parameters">
                            <a class="nav-link parallelogram" asp-area="CfgManagement" asp-controller="Parameter" asp-action="Index">
                                <span class="text">查询参数</span>
                            </a>
                        </li>
                    </ul>
                    <!--回收站下的二级菜单-->
                    <ul class="navbar-nav d-none" data-name="trash">
                        <li class="nav-item" data-name="recycle-object-types">
                            <a class="nav-link parallelogram" asp-area="Basic" asp-controller="ObjectTypeCategory" asp-action="RecycleObjectTypes">
                                <span class="text">基础类型</span>
                            </a>
                        </li>
                        <li class="nav-item d-none" data-name="recycle-provinces">
                            <a class="nav-link parallelogram" asp-area="RegManagement" asp-controller="Province" asp-action="Trash">
                                <span class="text">回收省份</span>
                            </a>
                        </li>
                        <li class="nav-item d-none" data-name="recycle-cities">
                            <a class="nav-link parallelogram" asp-area="RegManagement" asp-controller="City" asp-action="Trash">
                                <span class="text">回收城市</span>
                            </a>
                        </li>
                        <li class="nav-item d-none" data-name="recycle-counties">
                            <a class="nav-link parallelogram" asp-area="RegManagement" asp-controller="City" asp-action="CountyTrash">
                                <span class="text">回收区县</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link parallelogram" href="javascript:void(0);">
                                <span class="text">车主列表</span>
                            </a>
                        </li>
                    </ul>
                </nav>
                <!--主页内容展示-->
                <div id="main">
                    <!--导航-->
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            @RenderSection("navigation", false)
                        </ol>
                    </nav>
                    <!--主容器-->
                    <div data-name="main">
                        @RenderBody()
                    </div>
                    <!--modal-content容器0-->
                    <div class="modal-content" data-name="modal-content-0" style="display:none;">
                        <div class="modal-header"></div>
                        <div class="modal-body"></div>
                        <div class="modal-footer"></div>
                    </div>
                    <!--modal-content容器1-->
                    <div class="modal-content" data-name="modal-content-1" style="display:none;">
                        <div class="modal-header"></div>
                        <div class="modal-body"></div>
                        <div class="modal-footer"></div>
                    </div>
                    <!--modal-content容器2-->
                    <div class="modal-content" data-name="modal-content-2" style="display:none;">
                        <div class="modal-header"></div>
                        <div class="modal-body"></div>
                        <div class="modal-footer"></div>
                    </div>
                </div>
                <!--页面尾部-->
                <footer>
                    <i class="text-muted">南京XXX信息技术有限公司</i>
                </footer>
            </div>
        </div>
        <!--modal-dialog容器０-->
        <div class="modal fade" role="dialog" data-bs-backdrop="static" id="div-modal-dialog-0">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header"></div>
                    <div class="modal-body"></div>
                    <div class="modal-footer"></div>
                </div>
            </div>
        </div>
        <!--初始化-->
        <script type="text/javascript">
            //初始化加载bootstrap对象
            init_bootstrap_tooltips();
            init_bootstrap_modals();
            //选中当前菜单
            select_menu();
            //显示当前登录角色下所有授权的菜单
            show_login_role_menus();
        </script>
    </body>
</html>
